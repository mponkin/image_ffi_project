# Проектная работа модуля 4. Обработчик изображений с плагинами

Цель проекта — разработать CLI-приложение для обработки изображений с поддержкой динамически подключаемых плагинов через FFI.

## Структура проекта

В рабочем пространстве проекта находсятся 4 крейта:
* image_processor - основное приложение, отвечающее за обработку входящих параметров и вызов соответствующих плагинов
* blur_plugin - плагин, реализующий функционал размытия изображений
* mirror_plugin - плагин, реализующий функционал отражения изображений
* plugin_errors - общие коды ошибок

## Порядок работы приложения

1. Парсинг входных параметров
2. Проверка наличия указанных путей в системе
3. Вызов плагина через стандартный интерфейс для плагина обработки изображения, соответствующей сигнатуре на языке С
```C
int32_t process_image(
    uint32_t width, // ширина изображения
    uint32_t height, // высота изображения
    uint8_t* rgba_data, // указатель на массив данных изображения в формате RGBA (4 байта на пиксель)
    const char* params // указатель на строку параметров плагина
);
```
4. Если плагин вернул код успешной обработки - сохранение данных из `rgba_data` в файл вывода

## Параметры запуска

| Параметр |Описание | Значение по умолчанию |
|-|-|-|
| input | путь к изображению для обработки | |
| output | путь для сохранения результата работы | |
| plugin | название плагина | |
| params | путь к файлу параметров плагина | |
| plugin_path | путь к папке со скомпилированными плагинами | `target/debug` |

### Примеры команд для запуска

`cargo run -- --input demo/weather.png --output out_blur.png --plugin blur --params demo/blur_box.json`

`cargo run -- --input demo/weather.png --output out_mirror.png --plugin mirror --params demo/mirror_both.json`

## Параметры плагинов

### Blur

Параметры передаются в JSON формате 
| Параметр | Описание |
|-|-|
| radius | радиус размытия в пикселях |
| iterations | количество итераций применения размытия |
| weighted | использовать ли "вес" пикселей при размытии: чем дальше - тем ниже вес, аналог сглаживания по Гауссу |

Пример параметров 
```
{
  "radius": 8, 
  "iterations": 3, 
  "weighted": true
}
```

Код данного плагина не оптимизирован и работа на больших изображениях, а так же с большим радиусом или количенством итераций может занять длительное время

### Mirror

Параметры передаются в JSON формате 
| Параметр | Описание |
|-|-|
| horizontal | отобразить изображение по горизонтали |
| vertical | отобразить изображение по вертикали |

Пример параметров 
```
{
  "horizontal": false,
  "vertical": true
}
```

## Demo

В проекте присутствует папка `demo`, содержащая демонстрационное изображение и примеры конфигураций. 
При запуске скрипта `demo.sh` из корневой папки проекта произойдет 
- сборка проекта (по умолчанию в режиме `debug`, можно включить релизную сборку передав ключ `./demo.sh --release`)
- (Пере)создатся папка `demo_output`
- будет вызвано собранное приложение с разными параметрами, в результате чего в папке `demo_output` появится 5 результатов работы приложения в разных конфигурациях